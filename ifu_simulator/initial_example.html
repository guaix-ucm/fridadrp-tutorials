

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Initial example &mdash; fridadrp-tutorials 0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=42210275" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=9edc463e" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=3defd07e" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=2709fde1"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../_static/copybutton.js?v=d2c30f9d"></script>
      <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
      <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Script arguments" href="script_arguments.html" />
    <link rel="prev" title="Running the IFU simulator" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            fridadrp-tutorials
              <img src="../_static/logo_FRIDA.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation/installation.html">Installing the development version</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Running the IFU simulator</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Initial example</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#the-scene-file-of-the-initial-example">The scene file of the initial example</a></li>
<li class="toctree-l3"><a class="reference internal" href="#files-generated-by-the-ifu-simulator">Files generated by the IFU simulator</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#image-test-ifu-white2d-method0-os10-fits">Image <code>test_ifu_white2D_method0_os10.fits</code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#image-test-ifu-white2d-method0-os1-fits">Image <code>test_ifu_white2D_method0_os1.fits</code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#image-test-ifu-3d-method0-fits">Image <code>test_ifu_3D_method0.fits</code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#image-test-rss-2d-method0-fits">Image <code>test_rss_2D_method0.fits</code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#image-test-detector-2d-method0-fits">Image <code>test_detector_2D_method0.fits</code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#image-test-rss-2d-method1-fits">Image <code>test_rss_2D_method1.fits</code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#image-test-ifu-3d-method1-fits">Image <code>test_ifu_3D_method1.fits</code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="script_arguments.html">Script arguments</a></li>
<li class="toctree-l2"><a class="reference internal" href="scene_yaml.html">The scene YAML file</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples.html">Some scene examples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../example_recipes/test1.html">Running a simple test recipe</a></li>
<li class="toctree-l1"><a class="reference internal" href="../auxiliary_tools/index.html">Auxiliary tools</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">fridadrp-tutorials</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Running the IFU simulator</a></li>
      <li class="breadcrumb-item active">Initial example</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/ifu_simulator/initial_example.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="initial-example">
<h1>Initial example<a class="headerlink" href="#initial-example" title="Link to this heading"></a></h1>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The first time you execute <code class="docutils literal notranslate"><span class="pre">fridadrp-ifu_simulator</span></code>, the output in the
terminal will show that some auxiliary files are being downloaded and stored in
a cache directory. You don’t need to worry about the specific location unless
you want to examine these files.</p>
</div>
<p>To facilitate the identification of the script parameters, we use the
backslash <code class="docutils literal notranslate"><span class="pre">\</span></code> symbol to indicate line continuation. The backslash
escapes the next character from being interpreted by the shell. If the
character following the backslash is a newline, then that newline
will not be interpreted as the end of the command. Instead, it
effectively allows a command to span multiple lines.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(venv_frida)</span> <span class="gp">$ </span>fridadrp-ifu_simulator<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--scene<span class="w"> </span>scene00.yaml<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--grating<span class="w"> </span>medium-K<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--scale<span class="w"> </span>fine<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--seeing_fwhm_arcsec<span class="w"> </span><span class="m">0</span>.05<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--rnoise<span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--bias<span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--seed<span class="w"> </span><span class="m">1234</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--output_dir<span class="w"> </span>work<span class="w"> </span>--record
</pre></div>
</div>
<div class="my-special-block no-copybutton highlight-ansi-shell-session notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-BrightGreen -C-BrightGreen">────────────────────── </span><span class=" -Color -Color-Bold -Color-Bold-Magenta -C-Bold -C-Magenta">Welcome to fridadrp-ifu_simulator</span><span class=" -Color -Color-BrightGreen -C-BrightGreen"> ───────────────────────</span>
Using fridadrp.tools.frida_ifu_simulator version <span class=" -Color -Color-Bold -Color-Bold-Cyan -C-Bold -C-Cyan">0.1</span>.dev156+gb081f58ec          
Output directory: work                                                          
<span class=" -Color -Color-Green -C-Green">* Processing: constant flux</span>                                                     
Saving file: test_ifu_white2D_method0_os1.fits                                  
Saving file: test_ifu_white2D_method0_os10.fits                                 
Saving file: test_ifu_3D_method0.fits                                           
Saving file: test_rss_2D_method0.fits                                           
Saving file: test_detector_2D_method0.fits                                      
Saving file: test_rss_2D_method1.fits                                           
Saving file: test_ifu_3D_method1.fits                                           
Total time elapsed: <span class=" -Color -Color-Bold -Color-Bold-BrightGreen -C-Bold -C-BrightGreen">0:00:02</span>.<span class=" -Color -Color-Bold -Color-Bold-Cyan -C-Bold -C-Cyan">396122</span>                                              
<span class=" -Color -Color-BrightGreen -C-BrightGreen">────────────────────────────────── </span><span class=" -Color -Color-Bold -Color-Bold-Magenta -C-Bold -C-Magenta"> Goodbye! </span><span class=" -Color -Color-BrightGreen -C-BrightGreen"> ──────────────────────────────────</span>
</pre></div>
</div>
<p>The first parameter, <code class="docutils literal notranslate"><span class="pre">--scene</span></code>, specifies the name of the external YAML file
that contains the <em>scene</em> description. Its content is explained below.</p>
<p>The second and third parameters, <code class="docutils literal notranslate"><span class="pre">--grating</span></code> and <code class="docutils literal notranslate"><span class="pre">--scale</span></code>, specify the grating
and scale that define the wavelength range and sampling, as well as the spatial
scale in the IFU field of view. In this example, we use the medium-K grating
and the fine scale camera. We also specify that the seeing FWHM is 0.05 arcsec,
the detector readout noise is 4 ADU, and the bias level is 1000 ADU. Finally,
we set <code class="docutils literal notranslate"><span class="pre">work</span></code> as the output subdirectory for the resulting files.</p>
<section id="the-scene-file-of-the-initial-example">
<span id="id1"></span><h2>The scene file of the initial example<a class="headerlink" href="#the-scene-file-of-the-initial-example" title="Link to this heading"></a></h2>
<p>In this specific example, we are using the file <a class="reference download internal" download="" href="../_downloads/e65c6a87deeec5ce744d9aacbf96deda/scene00.yaml"><code class="xref download docutils literal notranslate"><span class="pre">scene00.yaml</span></code></a>.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">scene_block_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">constant flux</span>
<span class="nt">spectrum</span><span class="p">:</span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">constant-flux</span>
<span class="nt">geometry</span><span class="p">:</span><span class="w"> </span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">point-like</span>
<span class="nt">nphotons</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2E6</span>
<span class="nt">wavelength_sampling</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">random</span><span class="w">            </span><span class="c1"># optional: default=random</span>
<span class="nt">apply_seeing</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span><span class="w">                     </span><span class="c1"># optional: default=True</span>
<span class="nt">apply_atmosphere_transmission</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span><span class="w">    </span><span class="c1"># optional: default=True</span>
<span class="nt">render</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span><span class="w">                           </span><span class="c1"># optional: default=True</span>
</pre></div>
</div>
<p>The relevant information is provided as mappings and collections using
indentation for scope. In this case the following first-order keys are
identified:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">scene_block_name</span></code>: the provided string is an arbitrary label defined by
the user to identify this <em>scene block</em>.</p>
<p>This key has no default value (it is mandatory).</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">spectrum</span></code>: this key opens an indented section that contains all the
information required to define the kind of spectrum to be associated to the
geometry described next. In this example we want to simulate a constant flux
spectrum, which is indicated by the key <code class="docutils literal notranslate"><span class="pre">type:</span> <span class="pre">constant-flux</span></code>.</p>
<p>This key has no default value (it is mandatory).</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">geometry</span></code>: this key opens an indented section that indicates how the
photons generated following the previous spectrum type are going to be
distributed in the IFU field of view.  In this example, we are using <code class="docutils literal notranslate"><span class="pre">type:</span> <span class="pre">point-like</span></code>, meaning that we want to place all the simulated photons at
the same point (by default, the center of the IFU field of view).</p>
<p>This key has no default value (it is mandatory).</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">nphotons</span></code>: total number of photons to be simulated.</p>
<p>This key has no default value (it is mandatory).</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">wavelength_sampling</span></code>: method employed to assing the wavelength to each
simulated photon. Two methods have been implemented:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">random</span></code>: the simulated wavelengths are assigned by randomly sampling
the cumulative distribution function of the simulated spectrum. This method
mimics the Poissonian arrival of photons.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fixed</span></code>: the simulated wavelengths are assigned by uniformly sampling the
cumulative distribution function of the simulated spectrum (i.e., avoding
the Poissonian noise). This last
method should provide a perfectly constant flux (+/- 1 photon due to
rounding) for an object with constant PHOTLAM, when using the parameter
<code class="docutils literal notranslate"><span class="pre">--spectral_blurring_pixel</span> <span class="pre">0</span></code>.</p></li>
</ul>
<p><em>Default value:</em> <code class="docutils literal notranslate"><span class="pre">random</span></code>.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">apply_seeing</span></code>: boolean key indicating whether seeing must be taken into
account. If <code class="docutils literal notranslate"><span class="pre">True</span></code>, each simulated photon is randomly displaced in the
focal plane of the IFU according to a probability distribution that is
determined by the seeing PSF.</p>
<p><em>Default value:</em> <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">apply_atmosphere_transmission</span></code>: boolean key indicating whether the
atmosphere transmission must be considered. If <code class="docutils literal notranslate"><span class="pre">True</span></code>, the atmospheric
transmission probability at the wavelength of each simulated photon is
evaluated, and a random number between 0 and 1 is generated in each case. If
the obtained number is greater than the transmission probability, the photon
is discarded.</p>
<p><em>Default value:</em> <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">render</span></code>: boolean key indicate whether the considered scene block must be
simulated. In this case, in which we only have a single scene block, this key
is not very relevant (it only makes sense <code class="docutils literal notranslate"><span class="pre">render:</span> <span class="pre">True</span></code>). But in more
complicated cases, it is useful to be able to set this key to <code class="docutils literal notranslate"><span class="pre">False</span></code> when
we want to simulate images with several objects and components in the IFU
field of view and one needs to remove some particular objects from the
simulation without deleting the corresponding lines in the YAML file.</p>
<p><em>Default value:</em> <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p>
</li>
</ul>
</section>
<section id="files-generated-by-the-ifu-simulator">
<h2>Files generated by the IFU simulator<a class="headerlink" href="#files-generated-by-the-ifu-simulator" title="Link to this heading"></a></h2>
<p>The execution of the IFU simulator generates several files. All of them
share the same prefix <code class="docutils literal notranslate"><span class="pre">test</span></code>. This can be easily modified using the parameter
<code class="docutils literal notranslate"><span class="pre">--prefix_intermediate_FITS</span></code> when running <code class="docutils literal notranslate"><span class="pre">fridadrp-ifu_simulator</span></code>.</p>
<table class="wrap-table docutils align-default" id="id2">
<caption><span class="caption-text">Files generated by the simulator</span><a class="headerlink" href="#id2" title="Link to this table"></a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>Filename</p></th>
<th class="head"><p>Short description</p></th>
<th class="head"><p>BITPIX(*)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>test_ifu_white2D_method0_os10.fits</p></td>
<td><p>White light image (IFU, oversampling=10)</p></td>
<td><p>16 / -32</p></td>
</tr>
<tr class="row-odd"><td><p>test_ifu_white2D_method0_os1.fits</p></td>
<td><p>White light image (IFU, no oversampling)</p></td>
<td><p>16 / -32</p></td>
</tr>
<tr class="row-even"><td><p>test_ifu_3D_method0.fits</p></td>
<td><p>3D cube (simulated photons)</p></td>
<td><p>16 / -32</p></td>
</tr>
<tr class="row-odd"><td><p>test_rss_2D_method0.fits</p></td>
<td><p>RSS version of 3D cube</p></td>
<td><p>16 / -32</p></td>
</tr>
<tr class="row-even"><td><p>test_detector_2D_method0.fits</p></td>
<td><p>Hawaii detector image</p></td>
<td><p>(16) / -32</p></td>
</tr>
<tr class="row-odd"><td><p>test_rss_2D_method1.fits</p></td>
<td><p>Reconstructed RSS from Hawaii</p></td>
<td><p>-32</p></td>
</tr>
<tr class="row-even"><td><p>test_ifu_3D_method1.fits</p></td>
<td><p>Reconstructed 3D cube from RSS</p></td>
<td><p>-32</p></td>
</tr>
</tbody>
</table>
<p>(*) Note: the BITPIX column values in this table correspond to the following
situations:</p>
<ul class="simple">
<li><p><strong>BITPIX 16 / -32</strong>: The program first attempts to save the image with BITPIX
16. If the number of counts exceeds 65535, the image is automatically
promoted to BITPIX -32.</p></li>
<li><p><strong>BITPIX (16) / -32</strong>: The BITPIX value used depends on the <code class="docutils literal notranslate"><span class="pre">bitpix_detector</span></code>
parameter. If this parameter is set to 16 and the output array contains
negative numbers, they are set to zero. Similarly, numbers above 65535 are
clamped to 65535.</p></li>
<li><p><strong>BITPIX -32</strong>: The images are always saved with BITPIX -32.</p></li>
</ul>
<p>The mentioned files store different steps of the simulation procedure. Details
follow.</p>
<section id="image-test-ifu-white2d-method0-os10-fits">
<h3>Image <code>test_ifu_white2D_method0_os10.fits</code><a class="headerlink" href="#image-test-ifu-white2d-method0-os10-fits" title="Link to this heading"></a></h3>
<p>White-light image corresponding to the IFU field of view, using a particular
oversampling. By default, the oversampling is set to 10, and for that reason
the last part of the file name before the extension is <code class="docutils literal notranslate"><span class="pre">os10</span></code>. The
oversampling can be modified using the parameter <code class="docutils literal notranslate"><span class="pre">--noversampling_whitelight</span></code>
when running <code class="docutils literal notranslate"><span class="pre">fridadrp-ifu-simulator</span></code>.</p>
<p>Note that due to the oversampling factor, the shape of this image is
<code class="docutils literal notranslate"><span class="pre">NAXIS1=640</span></code> and <code class="docutils literal notranslate"><span class="pre">NAXIS2=600</span></code>.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(venv_frida)</span> <span class="gp">$ </span>numina-ximshow<span class="w"> </span>work/test_ifu_white2D_method0_os10.fits<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--cbar_orientation<span class="w"> </span>vertical<span class="w"> </span>--z1z2<span class="w"> </span>minmax<span class="w"> </span>--aspect<span class="w"> </span>equal
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/test_ifu_white2D_method0_os10.png"><img alt="image test_ifu_white2D_method0_os10.fits" src="../_images/test_ifu_white2D_method0_os10.png" style="width: 100%;" />
</a>
</section>
<section id="image-test-ifu-white2d-method0-os1-fits">
<h3>Image <code>test_ifu_white2D_method0_os1.fits</code><a class="headerlink" href="#image-test-ifu-white2d-method0-os1-fits" title="Link to this heading"></a></h3>
<p>White-light image without oversampling.</p>
<p>Since we are not using oversampling, in this case <code class="docutils literal notranslate"><span class="pre">NAXIS1=64</span></code> and
<code class="docutils literal notranslate"><span class="pre">NAXIS2=60</span></code>. Note that the number of counts is logically larger than in the
previous case by a factor <span class="math notranslate nohighlight">\(\sim 10^2\)</span>.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(venv_frida)</span> <span class="gp">$ </span>numina-ximshow<span class="w"> </span>work/test_ifu_white2D_method0_os1.fits<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--cbar_orientation<span class="w"> </span>vertical<span class="w"> </span>--z1z2<span class="w"> </span>minmax<span class="w"> </span>--aspect<span class="w"> </span>equal
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/test_ifu_white2D_method0_os1.png"><img alt="image test_ifu_white2D_method0_os1.fits" src="../_images/test_ifu_white2D_method0_os1.png" style="width: 100%;" />
</a>
<p>We can easily compare the last two exposures with <strong>ds9</strong> by matching their WCS
information (note the use of <code class="docutils literal notranslate"><span class="pre">-match</span> <span class="pre">frame</span> <span class="pre">wcs</span></code>).</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(venv_frida)</span> <span class="gp">$ </span>ds9<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-scale<span class="w"> </span>mode<span class="w"> </span>minmax<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-geometry<span class="w"> </span>1000x1000<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-wcs<span class="w"> </span>degrees<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-multiframe<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>work/test_ifu_white2D_method0_os1.fits<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>work/test_ifu_white2D_method0_os10.fits<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-lock<span class="w"> </span>slice<span class="w"> </span>image<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-lock<span class="w"> </span>frame<span class="w"> </span>image<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-zoom<span class="w"> </span>to<span class="w"> </span>fit<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-cmap<span class="w"> </span>viridis<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-match<span class="w"> </span>frame<span class="w"> </span>colorbar<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-match<span class="w"> </span>frame<span class="w"> </span>wcs<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-colorbar<span class="w"> </span>lock<span class="w"> </span>yes<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-view<span class="w"> </span>multi<span class="w"> </span>yes
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/comparison_white2D_os1_os10.png"><img alt="image comparison_white2D_os1_os10.png" src="../_images/comparison_white2D_os1_os10.png" style="width: 100%;" />
</a>
</section>
<section id="image-test-ifu-3d-method0-fits">
<h3>Image <code>test_ifu_3D_method0.fits</code><a class="headerlink" href="#image-test-ifu-3d-method0-fits" title="Link to this heading"></a></h3>
<p>3D data cube of the simulated photons. In this case
<code class="docutils literal notranslate"><span class="pre">NAXIS1=64</span></code>, <code class="docutils literal notranslate"><span class="pre">NAXIS2=60</span></code> and <code class="docutils literal notranslate"><span class="pre">NAXIS3=2048</span></code>.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(venv_frida)</span> <span class="gp">$ </span>fitsheader<span class="w"> </span>test_ifu_3D_method0.fits<span class="w"> </span>
</pre></div>
</div>
<div class="my-special-block no-copybutton highlight-default notranslate"><div class="highlight"><pre><span></span># HDU 0 in work/test_ifu_3D_method0.fits:
SIMPLE  =                    T / conforms to FITS standard                      
BITPIX  =                   16 / array data type                                
NAXIS   =                    3 / number of array dimensions                     
NAXIS1  =                   64                                                  
NAXIS2  =                   60                                                  
NAXIS3  =                 2048                                                  
EXTEND  =                    T                                                  
BSCALE  =                    1                                                  
BZERO   =                32768                                                  
COMMENT FITS (Flexible Image Transport System) format is defined in &#39;Astronomy  
COMMENT and Astrophysics&#39;, volume 376, page 359; bibcode: 2001A&amp;A...376..359H   
WCSAXES =                    3 / Number of coordinate axes                      
CRPIX1  =                 32.5 / Pixel coordinate of reference point            
CRPIX2  =                 30.5 / Pixel coordinate of reference point            
CRPIX3  =                  1.0 / Pixel coordinate of reference point            
CD1_1   = -2.7777777777777E-06 / Coordinate transformation matrix element       
CD2_2   =  2.7777777777778E-06 / Coordinate transformation matrix element       
CD3_3   =             2.85E-10 / Coordinate transformation matrix element       
CUNIT1  = &#39;deg&#39;                / Units of coordinate increment and value        
CUNIT2  = &#39;deg&#39;                / Units of coordinate increment and value        
CUNIT3  = &#39;m&#39;                  / Units of coordinate increment and value        
CTYPE1  = &#39;RA---TAN&#39;           / Right ascension, gnomonic projection           
CTYPE2  = &#39;DEC--TAN&#39;           / Declination, gnomonic projection               
CTYPE3  = &#39;WAVE&#39;               / Vacuum wavelength (linear)                     
CRVAL1  =                  0.0 / [deg] Coordinate value at reference point      
CRVAL2  =                  0.0 / [deg] Coordinate value at reference point      
CRVAL3  =           1.9344E-06 / [m] Coordinate value at reference point        
LONPOLE =                180.0 / [deg] Native longitude of celestial pole       
LATPOLE =                  0.0 / [deg] Native latitude of celestial pole        
MJDREF  =                  0.0 / [d] MJD of fiducial time                       
RADESYS = &#39;ICRS&#39;               / Equatorial coordinate system                   
OBSERVAT= &#39;ORM     &#39;           / Name of the observatory (IRAF style)           
TELESCOP= &#39;GTC     &#39;           / Telescope name                                 
ORIGIN  = &#39;fridadrp-ifu_simulator&#39; / FITS file originator                       
LATITUDE= &#39;+28:45:43.2&#39;        / Telescope latitude (degrees), +28:45:43.2      
LONGITUD= &#39;+17:52:39.5&#39;        / Telescope longitude (degrees), +17:52:39.5     
HEIGHT  =                 2348 / Telescope height above sea level (m)           
AIRMASS =                  1.0 / Airmass                                        
IPA     =                  0.0 / Instrument position angle (degrees)            
PARANGLE=                  0.0 / Parallactic angle (degrees)                    
INSTRUME= &#39;FRIDA   &#39;           / Instrument name                                
OBSMODE = &#39;IFS     &#39;           / Observation mode                               
SCALE   = &#39;FINE    &#39;           / Camera scale                                   
GRATING = &#39;MEDIUM-K&#39;           / Grating                                        
RA      = &#39;00:00:00.000&#39;       / Telescope right ascension (HH:MM:SS)           
DEC     = &#39;00:00:00.000&#39;       / Telescope declination (DD:MM:SS)               
RADEG   =                  0.0 / Telescope right ascension (degrees)            
DECDEG  =                  0.0 / Telescope declination (degrees)                
HISTORY -------------------------                                               
HISTORY Date: 2026-02-11 18:58:58                                               
HISTORY -------------------------                                               
HISTORY Node: iblax.fis.ucm.es                                                  
HISTORY Python: /Users/cardiel/venv_frida/bin/python3.13                        
HISTORY $ fridadrp-ifu_simulator                                                
HISTORY (version: 0.1.dev156+gb081f58ec)                                        
HISTORY --scene scene00.yaml                                                    
HISTORY --flux_factor 1.0                                                       
HISTORY --grating medium-K                                                      
HISTORY --scale fine                                                            
HISTORY --ra_teles_deg 0.0                                                      
HISTORY --dec_teles_deg 0.0                                                     
HISTORY --delta_ra_teles_arcsec 0.0                                             
HISTORY --delta_dec_teles_arcsec 0.0                                            
HISTORY --seeing_fwhm_arcsec 0.05                                               
HISTORY --seeing_psf gaussian                                                   
HISTORY --instrument_pa_deg 0.0                                                 
HISTORY --airmass 1.0                                                           
HISTORY --parallactic_angle_deg 0.0                                             
HISTORY --noversampling_whitelight 10                                           
HISTORY --atmosphere_transmission default                                       
HISTORY --bias 100                                                              
HISTORY --rnoise 4.0                                                            
HISTORY --flatpix2pix default                                                   
HISTORY --spectral_blurring_pixel 1.0                                           
HISTORY --seed 1234                                                             
HISTORY --noparallel False                                                      
HISTORY --prefix_intermediate_FITS test                                         
HISTORY --stop_after_ifu_3D_method0 False                                       
HISTORY --plots False                                                           
HISTORY --log_level INFO                                                        
HISTORY --output_dir work                                                       
HISTORY --record True                                                           
HISTORY --echo False                                                            
HISTORY --version False                                                         
</pre></div>
</div>
<p>It is possible to have a look to this image using QFitsView</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(venv_frida)</span> <span class="gp">$ </span>qfitsview<span class="w"> </span>test_ifu_3D_method0.fits
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/test_ifu_3D_method0_plot1.png"><img alt="image test_ifu_3D_method0.fits, plot 1" src="../_images/test_ifu_3D_method0_plot1.png" style="width: 100%;" />
</a>
<a class="reference internal image-reference" href="../_images/test_ifu_3D_method0_plot2.png"><img alt="image test_ifu_3D_method0.fits, plot 2" src="../_images/test_ifu_3D_method0_plot2.png" style="width: 100%;" />
</a>
</section>
<section id="image-test-rss-2d-method0-fits">
<h3>Image <code>test_rss_2D_method0.fits</code><a class="headerlink" href="#image-test-rss-2d-method0-fits" title="Link to this heading"></a></h3>
<p>RSS (Raw Stacked Spectra) corresponding to the same information stored in the
previous file. The shape of this image is <code class="docutils literal notranslate"><span class="pre">NAXIS1=2048</span></code> (spectral axis) and
<code class="docutils literal notranslate"><span class="pre">NAXIS2=1920</span></code> (spatial axis). Note that the <span class="math notranslate nohighlight">\(1920 = 64 \times 30\)</span>, where 30
is the number of the IFU slices, and 64 is the number of pixels along the
NAXIS1 spatial direction of the white-ligth images.</p>
<p>Note that here the slices are vertically ordered in ascending order, from 1 to
30, starting from the bottom left corner of the image.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(venv_frida)</span> <span class="gp">$ </span>numina-ximshow<span class="w"> </span>work/test_rss_2D_method0.fits<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--cbar_orientation<span class="w"> </span>vertical<span class="w"> </span>--z1z2<span class="w"> </span>minmax<span class="w"> </span>--aspect<span class="w"> </span>equal
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/test_rss_2D_method0.png"><img alt="image test_rss_2D_method0.fits" src="../_images/test_rss_2D_method0.png" style="width: 100%;" />
</a>
</section>
<section id="image-test-detector-2d-method0-fits">
<h3>Image <code>test_detector_2D_method0.fits</code><a class="headerlink" href="#image-test-detector-2d-method0-fits" title="Link to this heading"></a></h3>
<p>Simulation corresponding to the Hawaii detector version of the last image. Each
photon in the previous RSS image is transferred to the Hawaii detector making
use of the corresponding geometric distortions. The shape of this new image is
<code class="docutils literal notranslate"><span class="pre">NAXIS1=2048</span></code> and <code class="docutils literal notranslate"><span class="pre">NAXIS2=2048</span></code>.</p>
<p>Note that in this case, the slices appear in the following order when moving
vertically upwards in the image from the bottom left corner: 30, 1, 29, 2, 28,
3, 27, 4, 26, 5, 25, 6, 24, 7, 23, 8, 22, 9, 21, 10, 20, 11, 19, 12, 18, 13,
17, 14, 16, 15.</p>
<p>This simulated image also includes the following effects:</p>
<ul class="simple">
<li><p><strong>bias</strong>: the input bias level (assumed constant).</p></li>
<li><p><strong>flatfield</strong>: variation in the pixel-to-pixel response. A predefined
simulated flatfield image is assumed for the adopted grating.</p></li>
<li><p><strong>readout noise</strong>: the value specified in the <code class="docutils literal notranslate"><span class="pre">--rnoise</span></code> parameter of
<code class="docutils literal notranslate"><span class="pre">megaradrp-ifu_simulator</span></code> is used as the standard deviation of the Gaussian
distribution employed to generate the random values to be introduced in each
pixel of the detector.</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(venv_frida)</span> <span class="gp">$ </span>numina-ximshow<span class="w"> </span>work/test_detector_2D_method0.fits<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--cbar_orientation<span class="w"> </span>vertical<span class="w"> </span>--z1z2<span class="w"> </span>minmax<span class="w"> </span>--aspect<span class="w"> </span>equal
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/test_detector_2D_method0.png"><img alt="image test_detector_2D_method0.fits" src="../_images/test_detector_2D_method0.png" style="width: 100%;" />
</a>
</section>
<section id="image-test-rss-2d-method1-fits">
<h3>Image <code>test_rss_2D_method1.fits</code><a class="headerlink" href="#image-test-rss-2d-method1-fits" title="Link to this heading"></a></h3>
<p>Reconstructed RSS image from the observed image on the Hawaii detector, taking
into account the geometric distortions of the image. This tests the procedure
that will be applied in the FRIDA pipeline based on real observations.</p>
<p>As expected, the shape of this image is <code class="docutils literal notranslate"><span class="pre">NAXIS1=2048</span></code> (spectral axis) and
<code class="docutils literal notranslate"><span class="pre">NAXIS2=1920</span></code>.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(venv_frida)</span> <span class="gp">$ </span>numina-ximshow<span class="w"> </span>work/test_rss_2D_method1.fits<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--cbar_orientation<span class="w"> </span>vertical<span class="w"> </span>--z1z2<span class="w"> </span>minmax<span class="w"> </span>--aspect<span class="w"> </span>equal
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/test_rss_2D_method1.png"><img alt="image test_rss_2D_method1.fits" src="../_images/test_rss_2D_method1.png" style="width: 100%;" />
</a>
<p>It is possible to compare the two RSS images (before and after the simulation)
using <strong>ds9</strong>. Note that the simulated RSS exhibit a background pattern
corresponding to the bias level that, in addition, is not homogeneous. This
reflects the fact that each</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(venv_frida)</span> <span class="gp">$ </span>ds9<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-scale<span class="w"> </span>mode<span class="w"> </span>minmax<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-geometry<span class="w"> </span>1000x1000<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-wcs<span class="w"> </span>degrees<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-multiframe<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>work/test_rss_2D_method0.fits<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>work/test_rss_2D_method1.fits<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-lock<span class="w"> </span>slice<span class="w"> </span>image<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-lock<span class="w"> </span>frame<span class="w"> </span>image<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-zoom<span class="w"> </span>to<span class="w"> </span>fit<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-cmap<span class="w"> </span>viridis<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-match<span class="w"> </span>frame<span class="w"> </span>colorbar<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-colorbar<span class="w"> </span>lock<span class="w"> </span>yes<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-view<span class="w"> </span>multi<span class="w"> </span>yes
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/comparison_rss_2D_method0_method1.png"><img alt="image comparison_rss_2D_method0_method1.png" src="../_images/comparison_rss_2D_method0_method1.png" style="width: 100%;" />
</a>
</section>
<section id="image-test-ifu-3d-method1-fits">
<h3>Image <code>test_ifu_3D_method1.fits</code><a class="headerlink" href="#image-test-ifu-3d-method1-fits" title="Link to this heading"></a></h3>
<p>Reconstructed 3D data cube built from the previous image. As expected for the
3D view of these data, <code class="docutils literal notranslate"><span class="pre">NAXIS1=64</span></code>, <code class="docutils literal notranslate"><span class="pre">NAXIS2=60</span></code> and <code class="docutils literal notranslate"><span class="pre">NAXIS3=2048</span></code>.
This file simulates the result that will be obtained after reducing a single
pointing.</p>
<p>We can easily compare the while-light image obtained in the two simulated
versions of the data cubes.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(venv_frida)</span> <span class="gp">$ </span>numina-extract_2d_slice_from_3d_cube<span class="w"> </span>work/test_ifu_3D_method0.fits
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(venv_frida)</span> <span class="gp">$ </span>numina-extract_2d_slice_from_3d_cube<span class="w"> </span>work/test_ifu_3D_method1.fits
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/projected_3D_method0.png"><img alt="../_images/projected_3D_method0.png" src="../_images/projected_3D_method0.png" style="width: 49%;" />
</a>
<a class="reference internal image-reference" href="../_images/projected_3D_method1.png"><img alt="../_images/projected_3D_method1.png" src="../_images/projected_3D_method1.png" style="width: 49%;" />
</a>
<p>You can easily compare both images at each wavelength using <strong>ds9</strong>.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(venv_frida)</span> <span class="gp">$ </span>ds9<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-scale<span class="w"> </span>mode<span class="w"> </span>minmax<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-geometry<span class="w"> </span>1000x1000<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-wcs<span class="w"> </span>degrees<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-multiframe<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>work/test_ifu_3D_method0.fits<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>work/test_ifu_3D_method1.fits<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-lock<span class="w"> </span>slice<span class="w"> </span>image<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-lock<span class="w"> </span>frame<span class="w"> </span>image<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-zoom<span class="w"> </span>to<span class="w"> </span>fit<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-cmap<span class="w"> </span>viridis<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-match<span class="w"> </span>frame<span class="w"> </span>colorbar<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-colorbar<span class="w"> </span>lock<span class="w"> </span>yes<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-view<span class="w"> </span>multi<span class="w"> </span>yes
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/comparison_ifu_3D_method0_method1.png"><img alt="image comparison_ifu_3D_method0_method1.png" src="../_images/comparison_ifu_3D_method0_method1.png" style="width: 100%;" />
</a>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="Running the IFU simulator" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="script_arguments.html" class="btn btn-neutral float-right" title="Script arguments" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024-2026, Nicolás Cardiel, Sergio Pascual.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>